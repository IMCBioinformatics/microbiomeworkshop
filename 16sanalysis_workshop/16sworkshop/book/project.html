<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Project | 16s rRNA analysis workshop</title>
  <meta name="description" content="This tutorial covers workshop material for all three days" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Project | 16s rRNA analysis workshop" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This tutorial covers workshop material for all three days" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Project | 16s rRNA analysis workshop" />
  
  <meta name="twitter:description" content="This tutorial covers workshop material for all three days" />
  

<meta name="author" content="Hena R. Ramay" />


<meta name="date" content="2021-11-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="day-two.html"/>
<link rel="next" href="what-next.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">16s rRNA Analysis Workshop</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#workshop-schedule"><i class="fa fa-check"></i><b>1.1</b> Workshop Schedule</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#important-links"><i class="fa fa-check"></i><b>1.2</b> Important links</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basic-information.html"><a href="basic-information.html"><i class="fa fa-check"></i><b>2</b> Basic Information</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basic-information.html"><a href="basic-information.html#what-are-we-trying-to-achieve"><i class="fa fa-check"></i><b>2.1</b> What are we trying to achieve</a></li>
<li class="chapter" data-level="2.2" data-path="basic-information.html"><a href="basic-information.html#basics-background"><i class="fa fa-check"></i><b>2.2</b> Basics &amp; Background</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="primer-removal.html"><a href="primer-removal.html"><i class="fa fa-check"></i><b>3</b> Primer Removal</a>
<ul>
<li class="chapter" data-level="3.1" data-path="primer-removal.html"><a href="primer-removal.html#cutadapt"><i class="fa fa-check"></i><b>3.1</b> CutAdapt</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="primer-removal.html"><a href="primer-removal.html#primer-removal-for-paired-end-reads"><i class="fa fa-check"></i><b>3.1.1</b> Primer removal for paired end reads</a></li>
<li class="chapter" data-level="3.1.2" data-path="primer-removal.html"><a href="primer-removal.html#quality-trimming"><i class="fa fa-check"></i><b>3.1.2</b> Quality trimming</a></li>
<li class="chapter" data-level="3.1.3" data-path="primer-removal.html"><a href="primer-removal.html#call-cutadapt-from-r"><i class="fa fa-check"></i><b>3.1.3</b> Call cutAdapt from R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dada2.html"><a href="dada2.html"><i class="fa fa-check"></i><b>4</b> DADA2</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dada2.html"><a href="dada2.html#dada2-pipeline-v1.2"><i class="fa fa-check"></i><b>4.1</b> DADA2 pipeline (v1.2)</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="dada2.html"><a href="dada2.html#data-for-the-tutorial"><i class="fa fa-check"></i><b>4.1.1</b> Data for the tutorial</a></li>
<li class="chapter" data-level="4.1.2" data-path="dada2.html"><a href="dada2.html#getting-ready-load-packages-and-get-file-list"><i class="fa fa-check"></i><b>4.1.2</b> Getting ready ( load packages and get file list)</a></li>
<li class="chapter" data-level="4.1.3" data-path="dada2.html"><a href="dada2.html#inspect-read-quality-profiles"><i class="fa fa-check"></i><b>4.1.3</b> Inspect read quality profiles</a></li>
<li class="chapter" data-level="4.1.4" data-path="dada2.html"><a href="dada2.html#lets-make-plots-to-look-at-the-quality-for-multiple-files"><i class="fa fa-check"></i><b>4.1.4</b> Lets make plots to look at the quality for multiple files</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dada2.html"><a href="dada2.html#some-tips"><i class="fa fa-check"></i><b>4.2</b> Some tips:</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="day-two.html"><a href="day-two.html"><i class="fa fa-check"></i><b>5</b> Day Two</a>
<ul>
<li class="chapter" data-level="5.1" data-path="day-two.html"><a href="day-two.html#main-concepts-to-be-discussed"><i class="fa fa-check"></i><b>5.1</b> Main concepts to be discussed:</a></li>
<li class="chapter" data-level="5.2" data-path="day-two.html"><a href="day-two.html#alpha-beta-diversity"><i class="fa fa-check"></i><b>5.2</b> Alpha &amp; beta Diversity</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="project.html"><a href="project.html"><i class="fa fa-check"></i><b>6</b> Project</a>
<ul>
<li class="chapter" data-level="6.1" data-path="project.html"><a href="project.html#setup"><i class="fa fa-check"></i><b>6.1</b> Setup</a></li>
<li class="chapter" data-level="6.2" data-path="project.html"><a href="project.html#task-1-ignore-this-task"><i class="fa fa-check"></i><b>6.2</b> Task 1 (Ignore this task)</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="project.html"><a href="project.html#cutadapt-1"><i class="fa fa-check"></i><b>6.2.1</b> Cutadapt</a></li>
<li class="chapter" data-level="6.2.2" data-path="project.html"><a href="project.html#trimmomatic"><i class="fa fa-check"></i><b>6.2.2</b> Trimmomatic</a></li>
<li class="chapter" data-level="6.2.3" data-path="project.html"><a href="project.html#primers-removed"><i class="fa fa-check"></i><b>6.2.3</b> Primers removed</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="project.html"><a href="project.html#task-2"><i class="fa fa-check"></i><b>6.3</b> Task 2</a></li>
<li class="chapter" data-level="6.4" data-path="project.html"><a href="project.html#task-3"><i class="fa fa-check"></i><b>6.4</b> Task 3</a></li>
<li class="chapter" data-level="6.5" data-path="project.html"><a href="project.html#project-solutions"><i class="fa fa-check"></i><b>6.5</b> Project solutions</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="project.html"><a href="project.html#task-2---dada2"><i class="fa fa-check"></i><b>6.5.1</b> Task 2 - dada2</a></li>
<li class="chapter" data-level="6.5.2" data-path="project.html"><a href="project.html#task-3---phyloseq"><i class="fa fa-check"></i><b>6.5.2</b> Task 3 - phyloseq</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="what-next.html"><a href="what-next.html"><i class="fa fa-check"></i><b>7</b> What Next?</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">16s rRNA analysis workshop</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="project" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Project</h1>
<div id="setup" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Setup</h2>
<p>Please download the raw data <a href="https://www.dropbox.com/sh/1oy9upgzxlsra9y/AAANkbCj36lvP6vEQucE7fYna?dl=0">here</a>.</p>
<p>These samples are from a study looking at the effect of a prebiotic on the gut microbiota of children with type 1 diabetes. To invesigate this, the researchers took samples at three timepoints (baseline, 3 months, and 6 months) and sequenced the <strong>V3-V4</strong> region of the 16S rRNA gene.</p>
</div>
<div id="task-1-ignore-this-task" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Task 1 (Ignore this task)</h2>
<p>The first step with all sequence data is to ensure the primers have been removed. The two most common tools to accomplish this are <strong>Cutadapt</strong> and <strong>Trimmomatic</strong>.</p>
<p>Note: both of these tools can be used for quality trimming as well as primer removal but here we will perform the quality trimming in dada2 instead.</p>
<div id="cutadapt-1" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Cutadapt</h3>
<p>You can find the documentation for this tool <a href="https://cutadapt.readthedocs.io/en/stable/">here</a>.</p>
<p>These are the parameters that contain the primer sequences:</p>
<ul>
<li><code>-g : forward primer</code></li>
<li><code>-G : reverse primer</code></li>
<li><code>-a : reverse primer, reverse complement</code></li>
<li><code>-A : forward primer, reverse complement</code></li>
</ul>
<p>For this dataset, these are the appropriate primers:</p>
<pre><code>-g TCGTCGGCAGCGTCAGATGTGTATAAGAGACAGCCTACGGGNGGCWGCAG
-G GTCTCGTGGGCTCGGAGATGTGTATAAGAGACAGGACTACHVGGGTATCTAATCC
-a GGATTAGATACCCBDGTAGTCCTGTCTCTTATACACATCTCCGAGCCCACGAGAC
-A CTGCWGCCNCCCGTAGGCTGTCTCTTATACACATCTGACGCTGCCGACGA</code></pre>
<p>Here is an example of how to execute Cutadapt from the command line:</p>
<pre><code>cutadapt -g &lt;sequence&gt; -G &lt;sequence&gt; -a &lt;sequence&gt; -A &lt;sequence&gt; -o output_forward.fastq -p output_reverse.fastq input_forward.fastq input_reverse.fastq</code></pre>
<p>Note that you can also run cutadapt from within R. You can find instructions on how to do that <a href="https://benjjneb.github.io/dada2/ITS_workflow.html">here</a>.</p>
</div>
<div id="trimmomatic" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Trimmomatic</h3>
<p>You can find the documentation for this tool <a href="http://www.usadellab.org/cms/?page=trimmomatic">here</a>.</p>
<p>Instead of specifying forward and reverse reads, Trimmomatic takes a fasta file as input and searches the reads for all sequences in the files. When using Trimmomatic on paired-end reads, you will get four output files: forward and reverse reads that are still paired (reads for which both forward and reverse were kept) and forward and reverse reads that are unpaired. In general, the number of unpaired reads should be small and you can continue with your analysis without these.</p>
<p>For this dataset, you can use <a href="https://www.dropbox.com/s/wc2kihxfep23ycw/v3v4primers.fa?dl=0">this fasta</a>.</p>
<p>Here is an example of how to execute Trimmomatic from the command line:</p>
<pre><code>trimmomatic PE input_forward.fq.gz input_reverse.fq.gz output_forward_paired.fq.gz output_forward_unpaired.fq.gz output_reverse_paired.fq.gz output_reverse_unpaired.fq.gz ILLUMINACLIP:v3v4primers.fa:2:30:10:2:keepBothReads LEADING:0 TRAILING:0 MINLEN:0</code></pre>
</div>
<div id="primers-removed" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Primers removed</h3>
<p>If you donâ€™t care about using either of these tools and want to move on to the next step, you can find the sequences with the primers removed <a href="https://www.dropbox.com/s/qrf24anx9zllp9t/trimmed_data.zip?dl=0">here</a>.</p>
</div>
</div>
<div id="task-2" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Task 2</h2>
<p>Use the dada2 pipeline to generate a table of ASVs and a taxonomy table.</p>
<ol style="list-style-type: decimal">
<li>Plot quality profiles of the reads for all samples. Save these as pdf files.</li>
<li>Try a couple of sets of filtering params and determine the best choice.</li>
<li>Filter and trim the data and generate the quality plots again. Save these as well.</li>
<li>Learn the error rates and visually inspect the estimated error rates.</li>
<li>Infer samples.</li>
<li>Merge paired reads.</li>
<li>Construct sequence table.</li>
<li>Remove chimeras.</li>
<li>Track reads through the pipeline and ensure that no step of the analysis removed a large/unreasonable proportion of the reads.</li>
<li>Assign taxonomy using the Silva databse.</li>
<li>Save the ASV table and taxonomy table using the <code>saveRDS()</code> function.</li>
</ol>
</div>
<div id="task-3" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Task 3</h2>
<p>Use the phyloseq package to generate do some basic analysis. For this section you will need the project metadata files that you already downloaded</p>
<ol style="list-style-type: decimal">
<li>Generate a histogram of the number of reads per sample. Does this look okay?</li>
<li>Generate a table of alpha diversity measures (Shannon, Simspon, and Chao1) and use this table to plot alpha diversity by treatment and timepoint.</li>
<li>Transform the data to relative abundances and remove ASVs that are only present in less than 5% of the samples.</li>
<li>Perform a principal component analysis (PCoA) using the <code>ordinate()</code> function and <code>distance = "bray"</code>. Plot beta diversity.</li>
<li>Explore the composition of each sample by generating bar plots of the relative abundances at the level of phylum, family, and genus. For family and genus, plot only the top 10 most abundant taxa.</li>
</ol>
</div>
<div id="project-solutions" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Project solutions</h2>
<div id="task-2---dada2" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Task 2 - dada2</h3>
<p>For this section, the solution closely resembles the code from the <a href="http://benjjneb.github.io/dada2/tutorial.html">dada2 tutorial</a>. The main challenge is to determine the appropriate filtering parameters.</p>
<p>Here are the quality profiles for the forward and reverse reads for samples 01MP-1 and 03KW-1. You can see that the quality of the ends of the reverse reads are much worse than the forward reads.</p>
<p><img src="book/project_files/quality_01MP-1.png" /></p>
<p><img src="book/project_files/quality_03KW-1.png" />
To help guide our parameter choice, here is a plot showing the percentage of reads that passed filtering as a produce of changing both the forward error rate and the reverse error rate.</p>
<p><img src="book/project_files/filt_params.png" width="394" /></p>
<p>Based on this, we should choose an error rate of <code>c(3,4)</code> or something similar. Note that the truncation length used here was <code>c(265,245)</code>.</p>
<p>After filtering, we look the effect of the filtering on the quality profiles. Below are the before and after filtering quality profiles of the forward and reverse reads of sample 01MP-1.</p>
<p><img src="book/project_files/quality_filt_for_01MP-1.png" /></p>
<p><img src="book/project_files/quality_filt_rev_01MP-1.png" /></p>
</div>
<div id="task-3---phyloseq" class="section level3" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> Task 3 - phyloseq</h3>
<p>Following the dada2 pipeline, we will have a sequence table and a taxonomy table.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="project.html#cb27-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">&quot;./book/project_files/&quot;</span></span>
<span id="cb27-2"><a href="project.html#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="project.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in files</span></span>
<span id="cb27-4"><a href="project.html#cb27-4" aria-hidden="true" tabindex="-1"></a>seqtab <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">file.path</span>(path, <span class="st">&quot;seqtab.rds&quot;</span>))</span>
<span id="cb27-5"><a href="project.html#cb27-5" aria-hidden="true" tabindex="-1"></a>taxa <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">file.path</span>(path, <span class="st">&quot;taxa.rds&quot;</span>))</span>
<span id="cb27-6"><a href="project.html#cb27-6" aria-hidden="true" tabindex="-1"></a>info <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">file.path</span>(path, <span class="st">&quot;project_metadata.txt&quot;</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-7"><a href="project.html#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="project.html#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Match sample names</span></span>
<span id="cb27-9"><a href="project.html#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(info) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(seqtab)</span>
<span id="cb27-10"><a href="project.html#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="project.html#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a phyloseq object</span></span>
<span id="cb27-12"><a href="project.html#cb27-12" aria-hidden="true" tabindex="-1"></a>ps <span class="ot">&lt;-</span> <span class="fu">phyloseq</span>(<span class="fu">otu_table</span>(seqtab, <span class="at">taxa_are_rows=</span><span class="cn">FALSE</span>), <span class="fu">sample_data</span>(info), <span class="fu">tax_table</span>(taxa))</span>
<span id="cb27-13"><a href="project.html#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="project.html#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Make timepoint a factor</span></span>
<span id="cb27-15"><a href="project.html#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_data</span>(ps)<span class="sc">$</span>timepoint <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">sample_data</span>(ps)<span class="sc">$</span>timepoint)</span>
<span id="cb27-16"><a href="project.html#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="project.html#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Histogram of reads per sample</span></span>
<span id="cb27-18"><a href="project.html#cb27-18" aria-hidden="true" tabindex="-1"></a>sums <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">otu_table</span>(ps))</span>
<span id="cb27-19"><a href="project.html#cb27-19" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as</span>(<span class="fu">sample_data</span>(ps), <span class="st">&quot;data.frame&quot;</span>), <span class="at">totalreads =</span> sums)</span>
<span id="cb27-20"><a href="project.html#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="project.html#cb27-21" aria-hidden="true" tabindex="-1"></a>qq <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(counts, <span class="fu">aes</span>(totalreads)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.02</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Read counts per sample&quot;</span>) <span class="sc">+</span> <span class="fu">scale_x_log10</span>()</span>
<span id="cb27-22"><a href="project.html#cb27-22" aria-hidden="true" tabindex="-1"></a>qq</span></code></pre></div>
<p><img src="16sworkshop_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="project.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Alpha diversity</span></span>
<span id="cb28-2"><a href="project.html#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="project.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Make table of alpha diversity calculations</span></span>
<span id="cb28-4"><a href="project.html#cb28-4" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fu">estimate_richness</span>(ps, <span class="at">measures =</span> <span class="fu">c</span>(<span class="st">&quot;Chao1&quot;</span>, <span class="st">&quot;Shannon&quot;</span>, <span class="st">&quot;Simpson&quot;</span>))</span>
<span id="cb28-5"><a href="project.html#cb28-5" aria-hidden="true" tabindex="-1"></a>alpha_info <span class="ot">&lt;-</span> <span class="fu">sample_data</span>(ps)</span>
<span id="cb28-6"><a href="project.html#cb28-6" aria-hidden="true" tabindex="-1"></a>aa <span class="ot">&lt;-</span> <span class="fu">cbind</span>(alpha, alpha_info)</span>
<span id="cb28-7"><a href="project.html#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="project.html#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="project.html#cb28-9" aria-hidden="true" tabindex="-1"></a>a0 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(aa, <span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> Shannon, <span class="at">fill =</span> timepoint)) <span class="sc">+</span></span>
<span id="cb28-10"><a href="project.html#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.fill =</span> <span class="cn">NULL</span>, <span class="at">outlier.shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb28-11"><a href="project.html#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb28-12"><a href="project.html#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.75</span>))</span>
<span id="cb28-13"><a href="project.html#cb28-13" aria-hidden="true" tabindex="-1"></a>a0</span></code></pre></div>
<p><img src="16sworkshop_files/figure-html/unnamed-chunk-6-2.png" width="672" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="project.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Beta diversity</span></span>
<span id="cb29-2"><a href="project.html#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="project.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to relative abundace</span></span>
<span id="cb29-4"><a href="project.html#cb29-4" aria-hidden="true" tabindex="-1"></a>rel <span class="ot">&lt;-</span> <span class="fu">transform_sample_counts</span>(ps, <span class="cf">function</span>(x) x <span class="sc">/</span> <span class="fu">sum</span>(x))</span>
<span id="cb29-5"><a href="project.html#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># filter out low prevalence ASVs</span></span>
<span id="cb29-6"><a href="project.html#cb29-6" aria-hidden="true" tabindex="-1"></a>prevdf <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="at">X =</span> <span class="fu">otu_table</span>(ps), <span class="at">MARGIN =</span> <span class="fu">ifelse</span>(<span class="fu">taxa_are_rows</span>(ps), <span class="at">yes =</span> <span class="dv">1</span>, <span class="at">no =</span> <span class="dv">2</span>), <span class="at">FUN =</span> <span class="cf">function</span>(x){<span class="fu">sum</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>)})</span>
<span id="cb29-7"><a href="project.html#cb29-7" aria-hidden="true" tabindex="-1"></a>prevdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">prevalence =</span> prevdf, <span class="at">total_abundance =</span> <span class="fu">taxa_sums</span>(ps), <span class="fu">tax_table</span>(ps))</span>
<span id="cb29-8"><a href="project.html#cb29-8" aria-hidden="true" tabindex="-1"></a>prevalence_threshold <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="sc">*</span> <span class="fu">nsamples</span>(ps)</span>
<span id="cb29-9"><a href="project.html#cb29-9" aria-hidden="true" tabindex="-1"></a>keeptaxa <span class="ot">&lt;-</span> <span class="fu">rownames</span>(prevdf)[prevdf<span class="sc">$</span>prevalence <span class="sc">&gt;=</span> prevalence_threshold]</span>
<span id="cb29-10"><a href="project.html#cb29-10" aria-hidden="true" tabindex="-1"></a>relf <span class="ot">&lt;-</span> <span class="fu">prune_taxa</span>(keeptaxa, rel)</span>
<span id="cb29-11"><a href="project.html#cb29-11" aria-hidden="true" tabindex="-1"></a>psf <span class="ot">&lt;-</span> <span class="fu">prune_taxa</span>(keeptaxa, ps)</span>
<span id="cb29-12"><a href="project.html#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="project.html#cb29-13" aria-hidden="true" tabindex="-1"></a>ord <span class="ot">&lt;-</span> <span class="fu">ordinate</span>(relf, <span class="at">method =</span> <span class="st">&quot;PCoA&quot;</span>, <span class="at">distance =</span> <span class="st">&quot;bray&quot;</span>)</span>
<span id="cb29-14"><a href="project.html#cb29-14" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fu">plot_ordination</span>(relf, ord, <span class="at">shape =</span> <span class="st">&quot;treatment&quot;</span>, <span class="at">color =</span> <span class="st">&quot;timepoint&quot;</span>) <span class="sc">+</span></span>
<span id="cb29-15"><a href="project.html#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb29-16"><a href="project.html#cb29-16" aria-hidden="true" tabindex="-1"></a>b0</span></code></pre></div>
<p><img src="16sworkshop_files/figure-html/unnamed-chunk-6-3.png" width="672" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="project.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Composition</span></span>
<span id="cb30-2"><a href="project.html#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="project.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Agglomerate to phylum, family, and genus level</span></span>
<span id="cb30-4"><a href="project.html#cb30-4" aria-hidden="true" tabindex="-1"></a>phy <span class="ot">&lt;-</span> <span class="fu">tax_glom</span>(relf, <span class="st">&quot;Phylum&quot;</span>)</span>
<span id="cb30-5"><a href="project.html#cb30-5" aria-hidden="true" tabindex="-1"></a>fam <span class="ot">&lt;-</span> <span class="fu">tax_glom</span>(relf, <span class="st">&quot;Family&quot;</span>)</span>
<span id="cb30-6"><a href="project.html#cb30-6" aria-hidden="true" tabindex="-1"></a>gen <span class="ot">&lt;-</span> <span class="fu">tax_glom</span>(relf, <span class="st">&quot;Genus&quot;</span>)</span>
<span id="cb30-7"><a href="project.html#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="project.html#cb30-8" aria-hidden="true" tabindex="-1"></a>phymelt <span class="ot">&lt;-</span> <span class="fu">psmelt</span>(phy)</span>
<span id="cb30-9"><a href="project.html#cb30-9" aria-hidden="true" tabindex="-1"></a>c0 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(phymelt, <span class="fu">aes</span>(sample_id, Abundance, <span class="at">fill =</span> Phylum)) <span class="sc">+</span></span>
<span id="cb30-10"><a href="project.html#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-11"><a href="project.html#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb30-12"><a href="project.html#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>treatment, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)</span>
<span id="cb30-13"><a href="project.html#cb30-13" aria-hidden="true" tabindex="-1"></a>c0</span></code></pre></div>
<p><img src="16sworkshop_files/figure-html/unnamed-chunk-6-4.png" width="672" /></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="project.html#cb31-1" aria-hidden="true" tabindex="-1"></a>top10 <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">taxa_sums</span>(fam), <span class="cn">TRUE</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb31-2"><a href="project.html#cb31-2" aria-hidden="true" tabindex="-1"></a>fam10 <span class="ot">&lt;-</span> <span class="fu">prune_taxa</span>(top10, fam)</span>
<span id="cb31-3"><a href="project.html#cb31-3" aria-hidden="true" tabindex="-1"></a>fammelt <span class="ot">&lt;-</span> <span class="fu">psmelt</span>(fam10)</span>
<span id="cb31-4"><a href="project.html#cb31-4" aria-hidden="true" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fammelt, <span class="fu">aes</span>(sample_id, Abundance, <span class="at">fill =</span> Family)) <span class="sc">+</span></span>
<span id="cb31-5"><a href="project.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="project.html#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb31-7"><a href="project.html#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>treatment, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)</span>
<span id="cb31-8"><a href="project.html#cb31-8" aria-hidden="true" tabindex="-1"></a>c1</span></code></pre></div>
<p><img src="16sworkshop_files/figure-html/unnamed-chunk-6-5.png" width="672" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="project.html#cb32-1" aria-hidden="true" tabindex="-1"></a>top10 <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">taxa_sums</span>(gen), <span class="cn">TRUE</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb32-2"><a href="project.html#cb32-2" aria-hidden="true" tabindex="-1"></a>gen10 <span class="ot">&lt;-</span> <span class="fu">prune_taxa</span>(top10, gen)</span>
<span id="cb32-3"><a href="project.html#cb32-3" aria-hidden="true" tabindex="-1"></a>genmelt <span class="ot">&lt;-</span> <span class="fu">psmelt</span>(gen10)</span>
<span id="cb32-4"><a href="project.html#cb32-4" aria-hidden="true" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(genmelt, <span class="fu">aes</span>(sample_id, Abundance, <span class="at">fill =</span> Genus)) <span class="sc">+</span></span>
<span id="cb32-5"><a href="project.html#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-6"><a href="project.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb32-7"><a href="project.html#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>treatment, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)</span>
<span id="cb32-8"><a href="project.html#cb32-8" aria-hidden="true" tabindex="-1"></a>c2</span></code></pre></div>
<p><img src="16sworkshop_files/figure-html/unnamed-chunk-6-6.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="day-two.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="what-next.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["16sworkshop.pdf", "16sworkshop.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
